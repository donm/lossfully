<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>
  Class: ThreadPool
  
    &mdash; lossfully-0.0.0 Documentation
  
</title>

  <link rel="stylesheet" href="css/style.css" type="text/css" media="screen" charset="utf-8" />

  <link rel="stylesheet" href="css/common.css" type="text/css" media="screen" charset="utf-8" />

<script type="text/javascript" charset="utf-8">
  relpath = '';
  if (relpath != '') relpath += '/';
</script>

  <script type="text/javascript" charset="utf-8" src="js/jquery.js"></script>

  <script type="text/javascript" charset="utf-8" src="js/app.js"></script>


  </head>
  <body>
    <script type="text/javascript" charset="utf-8">
      if (window.top.frames.main) document.body.className = 'frames';
    </script>
    
    <div id="header">
      <div id="menu">
  
    <a href="_index.html">Index (T)</a> &raquo; 
    
    
    <span class="title">ThreadPool</span>
  
  
  <div class="noframes"><span class="title">(</span><a href="." target="_top">no frames</a><span class="title">)</span></div>
</div>

      <div id="search">
  
    <a id="class_list_link" href="#">Class List</a>
  
    <a id="method_list_link" href="#">Method List</a>
  
    <a id="file_list_link" href="#">File List</a>
  
</div>
      <div class="clear"></div>
    </div>
    
    <iframe id="search_frame"></iframe>
    
    <div id="content"><h1>Class: ThreadPool
  
  
  
</h1>

<dl class="box">
  
    <dt class="r1">Inherits:</dt>
    <dd class="r1">
      <span class="inheritName">Object</span>
      
        <ul class="fullTree">
          <li>Object</li>
          
            <li class="next">ThreadPool</li>
          
        </ul>
        <a href="#" class="inheritanceTree">show all</a>
      
      </dd>
    
  
  
    
  
    
  
  
  
    <dt class="r2 last">Defined in:</dt>
    <dd class="r2 last">lib/lossfully/thread_pool.rb</dd>
  
</dl>
<div class="clear"></div>

<h2>Overview</h2><div class="docstring">
  <div class="discussion">
    <p>
There&#8217;s (at least) two ways to do this: 1) the Ruby Recipes way,
which is to make a thread for every incoming task, but put it to sleep
until there&#8217;s room in the pool for another task, or 2) have a pool of
threads that eat tasks from a queue.  This implements (2), mainly because
it seemed more fun to me.  But also because it doesn&#8217;t require the
explicit use of Mutexes at all; it uses them, for the sake of sending
signals with ConditionVaribles, but if those signals aren&#8217;t received
there would be a delay of at most 1 second.
</p>
<p>
Another uses thing about this implementation is for the case when every
task you anticipate adding to the ThreadPool of the same general form. 
Then then ThreadPool can be initialized with a block and you can just add
objects to the task queue.
</p>


  </div>
</div>
<div class="tags">
  
</div>
  <h2>Constant Summary</h2>
  
    <dl class="constants">
      
        <dt id="DEFAULT_BLOCK-constant" class="">DEFAULT_BLOCK =
          
        </dt>
        <dd><pre class="code"><span class='id lambda'>lambda</span> <span class='lbrace'>{</span><span class='op'>|</span><span class='id block'>block</span><span class='comma'>,</span> <span class='op'>&amp;</span><span class='id blk'>blk</span><span class='op'>|</span> <span class='id block'>block</span> <span class='op'>=</span> <span class='id blk'>blk</span> <span class='kw'>if</span> <span class='id block_given?'>block_given?</span> <span class='semicolon'>;</span> <span class='id block'>block</span><span class='period'>.</span><span class='id call'>call</span><span class='rbrace'>}</span></pre></dd>
      
    </dl>
  


  <h2>Instance Attribute Summary <small>(<a href="#" class="summary_toggle">collapse</a>)</small></h2>
  <ul class="summary">
    
      <li class="public ">
  <span class="summary_signature">
    
      <a href="#max_size-instance_method" title="#max_size (instance method)">- (Object) <strong>max_size</strong> </a>
    

    
  </span>
  
  
    
    
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
Returns the value of attribute max_size.
</p>
</div></span>
  
</li>

    
  </ul>




  
    <h2>
      Instance Method Summary
      <small>(<a href="#" class="summary_toggle">collapse</a>)</small>
    </h2>

    <ul class="summary">
      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#%3C%3C-instance_method" title="#&lt;&lt; (instance method)">- (Object) <strong>&lt;&lt;</strong>(block_or_item) </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#initialize-instance_method" title="#initialize (instance method)">- (ThreadPool) <strong>initialize</strong>(max_size = 2, block = nil, &amp;blk) </a>
    

    
  </span>
  
    <span class="note title constructor">constructor</span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
A new instance of ThreadPool.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#join-instance_method" title="#join (instance method)">- (Object) <strong>join</strong> </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#kill-instance_method" title="#kill (instance method)">- (Object) <strong>kill</strong> </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#process-instance_method" title="#process (instance method)">- (Object) <strong>process</strong>(block_or_item = nil, &amp;blk) </a>
    

    
      (also: #enq, #dispatch)
    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#queue_size-instance_method" title="#queue_size (instance method)">- (Object) <strong>queue_size</strong> </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#size-instance_method" title="#size (instance method)">- (Object) <strong>size</strong> </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#stop-instance_method" title="#stop (instance method)">- (Object) <strong>stop</strong> </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
    </ul>
  

<div id="constructor_details" class="method_details_list">
  <h2>Constructor Details</h2>
  
    <div class="method_details first">
  <p class="signature first" id="initialize-instance_method">
  
    - (<tt><span class='object_link'><a href="" title="ThreadPool (class)">ThreadPool</a></span></tt>) <strong>initialize</strong>(max_size = 2, block = nil, &amp;blk) 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
A new instance of ThreadPool
</p>


  </div>
</div>
<div class="tags">
  
</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


22
23
24
25
26
27
28
29
30
31
32
33
34</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/lossfully/thread_pool.rb', line 22</span>

<span class='kw'>def</span> <span class='id initialize'>initialize</span><span class='lparen'>(</span><span class='id max_size'>max_size</span> <span class='op'>=</span> <span class='int'>2</span><span class='comma'>,</span> <span class='id block'>block</span><span class='op'>=</span><span class='kw'>nil</span><span class='comma'>,</span> <span class='op'>&amp;</span><span class='id blk'>blk</span><span class='rparen'>)</span>
  <span class='ivar'>@running</span> <span class='op'>=</span> <span class='kw'>true</span>
  <span class='ivar'>@joining</span> <span class='op'>=</span> <span class='kw'>false</span>
  
  <span class='ivar'>@mutex</span> <span class='op'>=</span> <span class='const'>Mutex</span><span class='period'>.</span><span class='id new'>new</span>
  <span class='ivar'>@cv</span> <span class='op'>=</span> <span class='const'>ConditionVariable</span><span class='period'>.</span><span class='id new'>new</span>
  <span class='ivar'>@max_size</span> <span class='op'>=</span> <span class='id max_size'>max_size</span>
  <span class='id block'>block</span> <span class='op'>=</span> <span class='id blk'>blk</span> <span class='kw'>if</span> <span class='id block_given?'>block_given?</span>
  <span class='ivar'>@block</span> <span class='op'>=</span> <span class='id block'>block</span><span class='period'>.</span><span class='id nil?'>nil?</span> <span class='op'>?</span> <span class='const'>DEFAULT_BLOCK</span> <span class='op'>:</span> <span class='id block'>block</span>
  <span class='ivar'>@queue</span> <span class='op'>=</span> <span class='const'>Queue</span><span class='period'>.</span><span class='id new'>new</span>
  <span class='ivar'>@workers</span> <span class='op'>=</span> <span class='lbracket'>[</span><span class='rbracket'>]</span>
  <span class='ivar'>@master</span> <span class='op'>=</span> <span class='id master_thread'>master_thread</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
  
</div>

  <div id="instance_attr_details" class="attr_details">
    <h2>Instance Attribute Details</h2>
    
      
      <span id="max_size=-instance_method"></span>
      <span id="max_size-instance_method"></span>
      <div class="method_details first">
  <p class="signature first" id="max_size-instance_method">
  
    - (<tt>Object</tt>) <strong>max_size</strong> 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
Returns the value of attribute max_size
</p>


  </div>
</div>
<div class="tags">
  
</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


47
48
49</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/lossfully/thread_pool.rb', line 47</span>

<span class='kw'>def</span> <span class='id max_size'>max_size</span>
  <span class='ivar'>@max_size</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
  </div>


  <div id="instance_method_details" class="method_details_list">
    <h2>Instance Method Details</h2>
    
    
      <div class="method_details first">
  <p class="signature first" id="<<-instance_method">
  
    - (<tt>Object</tt>) <strong>&lt;&lt;</strong>(block_or_item) 
  

  
</p><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


56
57
58</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/lossfully/thread_pool.rb', line 56</span>

<span class='kw'>def</span> <span class='op'>&lt;&lt;</span> <span class='id block_or_item'>block_or_item</span>
  <span class='id process'>process</span> <span class='id block_or_item'>block_or_item</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="join-instance_method">
  
    - (<tt>Object</tt>) <strong>join</strong> 
  

  
</p><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


60
61
62
63
64
65
66
67
68</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/lossfully/thread_pool.rb', line 60</span>

<span class='kw'>def</span> <span class='id join'>join</span>
  <span class='ivar'>@running</span> <span class='op'>=</span> <span class='kw'>false</span>
  <span class='ivar'>@joining</span> <span class='op'>=</span> <span class='kw'>true</span>
  <span class='id signal_master'>signal_master</span>
  <span class='comment'># A weird bug happens on this next line if you don't test
</span>  <span class='comment'># @master.alive?, but only sometimes.  I don't care enough to
</span>  <span class='comment'># figure it out right now.
</span>  <span class='ivar'>@master</span><span class='period'>.</span><span class='id join'>join</span> <span class='kw'>if</span> <span class='ivar'>@master</span><span class='period'>.</span><span class='id alive?'>alive?</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="kill-instance_method">
  
    - (<tt>Object</tt>) <strong>kill</strong> 
  

  
</p><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


83
84
85
86
87</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/lossfully/thread_pool.rb', line 83</span>

<span class='kw'>def</span> <span class='id kill'>kill</span>
  <span class='ivar'>@queue</span><span class='period'>.</span><span class='id clear'>clear</span>
  <span class='ivar'>@workers</span><span class='period'>.</span><span class='id each'>each</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='symbol'>:kill</span><span class='rparen'>)</span>
  <span class='id join'>join</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="process-instance_method">
  
    - (<tt>Object</tt>) <strong>process</strong>(block_or_item = nil, &amp;blk) 
  

  
    <span class="aliases">Also known as:
    <span class="names"><span id='enq-instance_method'>enq</span>, <span id='dispatch-instance_method'>dispatch</span></span>
    </span>
  
</p><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


36
37
38
39
40
41
42
43
44
45</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/lossfully/thread_pool.rb', line 36</span>

<span class='kw'>def</span> <span class='id process'>process</span> <span class='lparen'>(</span><span class='id block_or_item'>block_or_item</span><span class='op'>=</span><span class='kw'>nil</span><span class='comma'>,</span> <span class='op'>&amp;</span><span class='id blk'>blk</span><span class='rparen'>)</span>
  <span class='id block_or_item'>block_or_item</span> <span class='op'>=</span> <span class='id blk'>blk</span> <span class='kw'>if</span> <span class='id block_given?'>block_given?</span>
  <span class='kw'>if</span> <span class='id block_or_item'>block_or_item</span><span class='period'>.</span><span class='id respond_to?'>respond_to?</span><span class='lparen'>(</span><span class='symbol'>:call</span><span class='rparen'>)</span> 
    <span class='ivar'>@queue</span> <span class='op'>&lt;&lt;</span> <span class='id block_or_item'>block_or_item</span>
  <span class='kw'>else</span>
    <span class='ivar'>@queue</span> <span class='op'>&lt;&lt;</span> <span class='id lambda'>lambda</span> <span class='lbrace'>{</span> <span class='ivar'>@block</span><span class='period'>.</span><span class='id call'>call</span><span class='lparen'>(</span><span class='id block_or_item'>block_or_item</span><span class='rparen'>)</span> <span class='rbrace'>}</span>
  <span class='kw'>end</span>

  <span class='id signal_master'>signal_master</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="queue_size-instance_method">
  
    - (<tt>Object</tt>) <strong>queue_size</strong> 
  

  
</p><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


74
75
76</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/lossfully/thread_pool.rb', line 74</span>

<span class='kw'>def</span> <span class='id queue_size'>queue_size</span>
  <span class='ivar'>@queue</span><span class='period'>.</span><span class='id size'>size</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="size-instance_method">
  
    - (<tt>Object</tt>) <strong>size</strong> 
  

  
</p><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


70
71
72</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/lossfully/thread_pool.rb', line 70</span>

<span class='kw'>def</span> <span class='id size'>size</span>
  <span class='ivar'>@workers</span><span class='period'>.</span><span class='id size'>size</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="stop-instance_method">
  
    - (<tt>Object</tt>) <strong>stop</strong> 
  

  
</p><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


78
79
80
81</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/lossfully/thread_pool.rb', line 78</span>

<span class='kw'>def</span> <span class='id stop'>stop</span>
  <span class='ivar'>@queue</span><span class='period'>.</span><span class='id clear'>clear</span>
  <span class='id join'>join</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
  </div>

</div>
    
    <div id="footer">
  Generated on Tue Aug 16 13:04:23 2011 by 
  <a href="http://yardoc.org" title="Yay! A Ruby Documentation Tool" target="_parent">yard</a>
  0.7.2 (ruby-1.9.2).
</div>

  </body>
</html>